/*!CK:210720625!*//*1394427056,178191957*/

if (self.CavalryLogger) { CavalryLogger.start_js(["CUHbs"]); }

__d("CollectionsRecommendationViewportTracking",["DOM","ViewportTracking","copyProperties","csx"],function(a,b,c,d,e,f,g,h,i,j){var k=55,l=200;for(var m in h)if(h.hasOwnProperty(m))o[m]=h[m];var n=h===null?null:h.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=h;function o(){"use strict";if(h!==null)h.apply(this,arguments);}o.prototype.getDataFromConfig=function(p){"use strict";this.control=p.control;};o.prototype.getTimeout=function(){"use strict";return l;};o.prototype.getAllStories=function(){"use strict";var p=[].concat(g.scry(this.control,"._3owb")).concat(g.scry(this.control,"._5jvf")).concat(g.scry(this.control,"._3cxw"));return p;};o.prototype.getStoryID=function(p){"use strict";var q=JSON.parse(p.getAttribute('data-gt'));return q&&q.token;};o.prototype.getDataToLog=function(p){"use strict";var q=i(JSON.parse(p.getAttribute('data-gt')),{evt:k});return {gt:q};};o.init=function(p){"use strict";var q=new o();q.init(i(p,{banzai:false}));return q;};e.exports=o;});
__d("TimelineCollectionAddRecommendation",["Event","AppSectionCurationState","AsyncRequest","CollectionsRecommendationViewportTracking","CSS","DOM","OGCollectionAddObject","OnVisible","Parent","TimelineAppCollection","TimelineAppSection","TimelineAppSectionCuration","TimelineSection","TriggerablePageletLoader","$","csx","cx","tidyEvent","copyProperties","DataStore"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){var aa={},ba="_5737",ca=250;m.subscribe(m.ADD_PLACEHOLDER,function(la,ma){p.incrementCount(ma);});m.subscribe(m.REMOVE_PLACEHOLDER,function(la,ma){p.decrementCount(ma);});function da(la){var ma=l.scry(la,"._3owb")[0];if(ma)return ma.getAttribute('data-obj');}function ea(la,ma){if(ma){var na=ma.nextSibling;na&&ia(na);aa[la].carousel.removeItem(ma);}aa[la].carousel.refresh();}function fa(la,ma){var na=[],oa=aa[la].carousel.getVisibleNodes(),pa=da(ma);for(var qa=0;qa<oa.length;++qa){var ra=da(oa[qa]);if(pa===ra)break;if(ra)na.push(ra);}return na;}function ga(la){var ma=[],na=aa[la].carousel.getVisibleNodes(),oa=aa[la].carousel.getVisibleNodesMax();for(var pa=1;pa<oa-1;pa++){if(pa===na.lentgh)break;var qa=da(na[pa]);if(qa)ma.push(qa);}return ma;}function ha(la,ma){var na=fa(la,ma);ea(la,ma);return na;}function ia(la){k.addClass(la,"_42fn");var ma=g.listen(la,'mouseover',function(){k.removeClass(la,"_42fn");ma.remove();});}function ja(la){var ma=aa[la];if(ma.filled)return;var na=q.getIDBySK(ma.data.sk);s.callWithSection(na,function(oa){var pa=oa.getActiveCollection().getToken(),qa=r.getSectionState(na);if(pa==ma.collectionToken&&qa===h.showItems&&ma.items.length>0){ma.filled=true;ma.carousel.addItems(ma.items);}});}var ka={addTriggerLoader:function(la,ma,na){new t({controller:'TimelineAppCollectionRecommendationPagelet',data:na,node:la,options:{crossPage:1,jsNonblock:1}},[{node:ma,type:t.TRIGGER_ONVISIBLE}]);},removeItemsByObjectIDs:function(la,ma){var na=aa[ma];if(!na)return;var oa=aa[ma].carousel.getNode();la.forEach(function(pa){var qa=l.scry(oa,'[data-obj="'+pa+'"]')[0];if(qa){var ra=o.byClass(qa,"_58rc");ha(ma,ra);}});},getPreviousItemIDs:function(la,ma){return fa(la,ma);},getPageletID:function(la){return 'pagelet_recommendation_'+la.split(':')[2];},init:function(la,ma,na,oa){var pa=aa[la]={carousel:ma,collectionToken:na.collection_token,data:na,isFirst:true,showPlusButtonItem:oa.items[0],items:oa.items,postUri:oa.post_uri,removeUri:oa.remove_uri,nextLinkData:oa.next_link_data,filled:oa.filled,headerPageletID:oa.header_pagelet_id,viewportTracking:j.init({control:ma.getNode()})};new n(pa.carousel.getNode(),function(){var ra=function(){ja(la);};q.subscribe('changeCollection',ra);r.register(q.getIDBySK(na.sk),ra);ra();},true,0);var qa=g.listen(pa.carousel.getNode(),'mouseenter',function(ra){qa.remove();if(pa.showPlusButtonItem)k.removeClass(pa.showPlusButtonItem,ba);});x([pa.carousel.subscribe('needsitems',ka.reloadRecommendation.bind(null,pa)),pa.carousel.subscribe('refreshed',pa.viewportTracking.fireTimer.bind(pa.viewportTracking)),pa.carousel.subscribe('lastelementremoved',function(ra){r.informState(h.hide,na.header_pagelet_id);setTimeout(function(){p.switchToNullStateCurationContent(na.collection_token);},ca);})]);x(g.listen(pa.carousel.getNextLink(),'mousedown',function(ra){pa.nextLinkData.rec_list_items=ga(la);pa.carousel.getNextLink().setAttribute('data-gt',JSON.stringify(pa.nextLinkData));}));x(g.listen(pa.carousel.getNode(),'click',function(ra){var sa=o.byTag(ra.getTarget(),'a');if(!sa)return;var ta="_gx8",ua="_vfm",va="_4-k4",wa=k.hasClass(sa,ta)||k.hasClass(sa,ua),xa=!wa&&k.hasClass(sa,va);if(wa||xa){var ya=o.byClass(sa,"_58rc"),za=l.find(ya,"._3owb"),ab=za.getAttribute('data-obj'),bb=JSON.parse(z.get(za,'post',null)),cb=ha(la,ya);if(wa){p.addPlaceholderToCollection(pa.collectionToken,ya);var db=pa.isFirst||0;delete pa.isFirst;new i(pa.postUri).setData(y({action:'add',item_id:ab,ignored_item_ids:cb,is_first:db,underlying_entity_id:ab},bb)).send();ra.prevent();}else new i(pa.removeUri).setData(y({objectid:ab,ignored_item_ids:cb},bb)).send();}}));},reloadRecommendation:function(la){if(!la.asyncing&&la.filled)la.asyncing=new i('/ajax/open_graph/recommendation_reload/').setData(la.data).send();},requestSuggestions:function(la,ma){if(!(la in aa))return;var na=aa[la].data;new i('/ajax/open_graph/similar_suggestions/').setData({pagelet_id:la,ogobjectid:ma,session_id:na.session_id,collection_token:na.collection_token}).setRelativeTo(u(q.getIDBySK(na.sk))).setHandler(this.onRequestSuggestionsComplete.bind(this,la)).send();},onRequestSuggestionsComplete:function(la){r.refreshState(h.showItems,q.getIDBySK(aa[la].data.sk));},removeItemFromRecommendations:function(la,ma){return ha(la,ma);},plusRecommendation:function(la,ma,na,oa,pa,qa){var ra=aa[la];p.addPlaceholderToCollection(pa,na);var sa=aa[ma];if(la!=ma&&sa){var ta=l.scry(sa.carousel.getNode(),'[data-obj="'+oa+'"]');if(ta&&ta.length>0){var ua=o.byClass(ta[0],"_58rc");ea(ma,ua);}}var va=null;if(qa){va=ha(la,na);}else va=fa(la,na);var wa=ra.isFirst||0;delete ra.isFirst;return {ignored_item_ids:va,is_first:wa,session_id:ra.sessionID};},populateSuggestionsList:function(la,ma,na,oa){var pa=aa[la];pa.asyncing=false;if(ma.length===0){pa.carousel.endCarousel();}else{pa.data.exclude_ids=na;pa.carousel.addItems(ma);pa.data.cursor=oa;}}};e.exports=ka;});
__d("TimelineCollectionUnlikeHandler",["Arbiter","AsyncRequest","CSS","PageLikeButton","TimelineAppCollection"],function(a,b,c,d,e,f,g,h,i,j,k){var l={};g.subscribe(j.UNLIKED,function(n,o){var p=l[o.profile_id];if(p){i.hide(p.buttons);k.decrementCount(k.getIDByToken(p.collectionToken));new h('/ajax/timeline/app_collection_item/unlike/fbpage/').setData({collection_token:p.collectionToken,profile_id:o.profile_id}).send();l[o.profile_id]=null;}});var m={init:function(n,o,p){l[n]={buttons:p,collectionToken:o};}};e.exports=m;});